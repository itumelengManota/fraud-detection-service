package com.twenty9ine.frauddetection.rules;

import com.twenty9ine.frauddetection.domain.model.VelocityMetrics;
import com.twenty9ine.frauddetection.domain.model.Transaction;
import com.twenty9ine.frauddetection.domain.service.RuleEvaluationResult;
import com.twenty9ine.frauddetection.domain.model.RuleTrigger;
import com.twenty9ine.frauddetection.domain.model.RiskImpact
import com.twenty9ine.frauddetection.domain.valueobject.RiskImpact
import com.twenty9ine.frauddetection.domain.valueobject.RuleTrigger;

global RuleEvaluationResult ruleEvaluationResult;

rule "High Velocity - 5 Minute Window"
    when
        $velocity : VelocityMetrics($count : fiveMinuteCount)
        eval($count > 5)
        $tx : Transaction()
    then
        ruleEvaluationResult.addTrigger(new RuleTrigger("VELOCITY_5MIN", "High Velocity 5min", RiskImpact.HIGH,
            "More than 5 transactions in 5 minutes", $count));
    end

rule "Extreme Velocity - 1 Hour Window"
    when
        $velocity : VelocityMetrics($count : oneHourCount)
        eval($count > 20)
        $tx : Transaction()
    then
        ruleEvaluationResult.addTrigger(new RuleTrigger("VELOCITY_1HOUR", "Extreme Velocity 1hr", RiskImpact.CRITICAL,
            "More than 20 transactions in 1 hour", $count));
    end