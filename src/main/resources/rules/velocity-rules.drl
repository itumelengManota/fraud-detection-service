import com.twenty9ine.frauddetection.domain.valueobject.VelocityMetrics
import com.twenty9ine.frauddetection.domain.valueobject.Transaction
import com.twenty9ine.frauddetection.domain.valueobject.TimeWindow
import com.twenty9ine.frauddetection.domain.service.RuleEvaluationResult
import com.twenty9ine.frauddetection.domain.valueobject.RuleTrigger
import com.twenty9ine.frauddetection.domain.valueobject.RiskImpact

global RuleEvaluationResult ruleEvaluationResult;

rule "High Velocity - 5 Minute Window"
    when
        $velocity : VelocityMetrics(getTransactionCount(TimeWindow.FIVE_MINUTES) > 5,
                                   $count : getTransactionCount(TimeWindow.FIVE_MINUTES))
        $tx : Transaction()
    then
        ruleEvaluationResult.addTrigger(
            new RuleTrigger(
                "VELOCITY_5MIN",
                "High Velocity 5min",
                RiskImpact.HIGH,
                "More than 5 transactions in 5 minutes",
                $count
            )
        );
end

rule "Extreme Velocity - 1 Hour Window"
    when
        $velocity : VelocityMetrics(getTransactionCount(TimeWindow.ONE_HOUR) > 20,
                                   $count : getTransactionCount(TimeWindow.ONE_HOUR))
        $tx : Transaction()
    then
        ruleEvaluationResult.addTrigger(
            new RuleTrigger(
                "VELOCITY_1HOUR",
                "Extreme Velocity 1hr",
                RiskImpact.CRITICAL,
                "More than 20 transactions in 1 hour",
                $count
            )
        );
end