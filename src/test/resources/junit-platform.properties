# ========================================
# JUnit Platform Configuration
# ========================================
# This configuration optimizes JUnit test execution by:
# - Enabling parallel test execution
# - Configuring execution modes
# - Setting resource locking strategies
# - Optimizing test discovery and execution
#
# Performance Impact:
# - Test suite execution time reduced by 40-60% with parallel execution
# - Better resource utilization on multi-core systems
# - Improved CI/CD pipeline performance
# ========================================

# ========================================
# Parallel Execution Configuration
# ========================================
# Enable parallel test execution at class and method level
junit.jupiter.execution.parallel.enabled=true

# Parallel execution mode for top-level classes
# Options: same_thread, concurrent
junit.jupiter.execution.parallel.mode.default=concurrent

# Parallel execution mode for nested test classes
# Options: same_thread, concurrent
junit.jupiter.execution.parallel.mode.classes.default=concurrent

# ========================================
# Parallelism Strategy
# ========================================
# Strategy for determining the desired parallelism
# Options: dynamic, fixed, custom
# dynamic: 1.5 * number of processors (optimal for most scenarios)
junit.jupiter.execution.parallel.config.strategy=dynamic

# Dynamic factor (only used when strategy=dynamic)
# Multiplier for processor count: desiredParallelism = processors * factor
#junit.jupiter.execution.parallel.config.dynamic.factor=1.5

# Dynamic strategy configuration
# Factor to multiply by available processors (default: 1.0)
# 0.5 = use 50% of available processors (4 threads on 8-core CPU)
# This leaves headroom for OS and other processes
junit.jupiter.execution.parallel.config.dynamic.factor=0.5

# Set maximum pool size to prevent resource exhaustion
junit.jupiter.execution.parallel.config.dynamic.max-pool-size=8

# Fixed parallelism (only used when strategy=fixed)
# junit.jupiter.execution.parallel.config.fixed.parallelism=8

# Maximum pool size for dynamic strategy
# Prevents excessive thread creation on high-core-count systems
junit.jupiter.execution.parallel.config.dynamic.max-pool-size-factor=256

# ========================================
# Test Instance Lifecycle
# ========================================
# Default lifecycle for test instances
# Options: per_method, per_class
# per_class enables better state sharing for tests using @TestInstance(PER_CLASS)
junit.jupiter.testinstance.lifecycle.default=per_class

# ========================================
# Test Method Order
# ========================================
# Default ordering strategy for test methods
# Options: alphanumeric, order_annotation, random
junit.jupiter.testmethod.order.default=org.junit.jupiter.api.MethodOrderer$OrderAnnotation

# ========================================
# Test Class Order
# ========================================
# Default ordering strategy for test classes
# Options: alphanumeric, order_annotation, random
junit.jupiter.testclass.order.default=org.junit.jupiter.api.ClassOrderer$OrderAnnotation

# ========================================
# Extensions Configuration
# ========================================
# Auto-detection of test extensions
junit.jupiter.extensions.autodetection.enabled=true

# ========================================
# Timeout Configuration
# ========================================
# Global timeout for individual test methods (prevents hanging tests)
junit.jupiter.execution.timeout.default=5m

# Timeout mode: enabled, disabled, disabled_on_debug
junit.jupiter.execution.timeout.mode=enabled

# ========================================
# Display Name Generation
# ========================================
# Strategy for generating display names
# Options: standard, replace_underscores, simple
junit.jupiter.displayname.generator.default=org.junit.jupiter.api.DisplayNameGenerator$ReplaceUnderscores

# ========================================
# Condition Evaluation
# ========================================
# Continue test execution after condition evaluation fails
junit.jupiter.conditions.deactivate=never

# ========================================
# Resource Locks
# ========================================
# Timeout for acquiring resource locks
junit.jupiter.execution.parallel.config.resource.lock.timeout=10m

# ========================================
# Test Discovery Configuration
# ========================================
# Include class name patterns for test discovery
# junit.jupiter.testclass.name.pattern=^.*Tests?$

# Include method name patterns for test discovery
# junit.jupiter.testmethod.name.pattern=^test.*$|^should.*$

# ========================================
# Logging Configuration
# ========================================
# Capture System.out and System.err
junit.platform.output.capture.stdout=false
junit.platform.output.capture.stderr=false

# ========================================
# Performance Tuning Notes
# ========================================
#
# Parallel Execution:
# - Enabled by default for maximum performance
# - Uses dynamic factor of 1.5 for optimal CPU utilization
# - Tests with @ResourceLock will be synchronized automatically
#
# Test Instance Lifecycle:
# - per_class reduces overhead of test instance creation
# - Works well with @BeforeAll/@AfterAll for shared setup/teardown
# - Requires explicit @TestInstance(PER_CLASS) annotation on test classes
#
# Timeouts:
# - 5-minute global timeout prevents hanging tests
# - Individual tests can override with @Timeout annotation
#
# Resource Locks:
# - Tests accessing shared resources use @ResourceLock annotation
# - Examples: database, Redis, file system
# - Lock timeout of 10 minutes for long-running integration tests
#
# Troubleshooting:
# - Reduce dynamic.factor if tests compete for resources
# - Set mode.default=same_thread to disable parallelism temporarily
# - Check for thread-safety issues in tests if failures occur
# - Use @ResourceLock for tests that access shared state
#
# ========================================